/*
 * Circles implementation for the GauntletII project.
 */

#include "Effect.h"

#define SPRITE_WIDTH 9
#define SPRITE_HEIGHT 9

static uint8_t heartData[SPRITE_WIDTH * SPRITE_HEIGHT] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00,
    0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0xFF, 0xFF, 0xFF, 0xFF,
    0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};

static uint8_t ghostData[SPRITE_WIDTH * SPRITE_HEIGHT] = {
    0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0x00, 0xFF, 0xFF, 0x00, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0x00, 0x00, 0xFF, 0x00, 0x00, 0xFF, 0xFF,
    0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00,
    0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00,
};


static uint8_t invaderData[SPRITE_WIDTH * SPRITE_HEIGHT] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 
    0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 
    0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 
    0xff, 0xff, 0xff, 0x00, 0xff, 0x00, 0xff, 0xff, 0xff, 
    0xff, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0xff, 
    0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};





class Sprite : public Effect {

   
private:
    
    int spriteWidth, spriteHeight;
    int sprite;
    int color;
    int colors[5] = {178, 0, 309, 193, 28};
    

public:
    Sprite(CRGB *leds, int width, int height, int numSprite) : Effect(leds, width, height), spriteWidth(SPRITE_WIDTH), spriteHeight(SPRITE_HEIGHT) {
      sprite = numSprite;
      color = colors[random(4)];
      if (numSprite = 3) {
        color = random(255);
      }
    }
    
    void start() {
        for (int i = 0; i < 200; i++) {
            switch(sprite) {
                case 1: 
                     blit(heartData, 0, random(0, width - spriteWidth), random(0, height - spriteHeight));
                     LEDS.show();
                     delay(200);
                     for (int i = 0; i < width * height; i++) {
                       leds[i].fadeToBlackBy(95);
                     }
                break;
                case 2: 
                     blit(ghostData, color , random(0, width - spriteWidth), random(0, height - spriteHeight));
                     delay(200);
                     LEDS.show();
                     clearLeds();
                break;
                case 3: 
                     blit(invaderData, color , random(0, width - spriteWidth), random(0, height - spriteHeight));
                     delay(200);
                     LEDS.show();
                     clearLeds();
                break;
            }
            
           /* for (int i = 0; i < width * height; i++) {
               leds[i].fadeToBlackBy(95);
            }*/
           
        }
    }
    
    void blit(uint8_t *sprite, uint8_t hue, int x, int y) {
        uint8_t saturation = random(8, 16) * 16;
        for (int spx = 0; spx < spriteWidth; spx++) {
            for (int spy = 0; spy < spriteHeight; spy++) {
                if (inXRange(spx + x) && inYRange(spy + y)) {
                    uint8_t spritePixel = sprite[spy * spriteHeight + spx];
                    if (spritePixel) {
                        pixel(spx + x, spy + y) = CHSV(hue, saturation, spritePixel);
                    }
                }
            }
        }
    }

};
